<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Task Report</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
	<script src="https://cdn.tailwindcss.com"></script>
	<style>
	  svg { max-width: 100%; height: auto; }
	</style>
</head>
<body class="bg-gray-50 p-8">
	<div class="max-w-7xl mx-auto">
		<!-- Header -->
		<div class="mb-8">
			<h1 class="text-3xl font-bold text-gray-900 mb-2">Task Report</h1>
			<p class="text-gray-600">October 14 - November 14, 2025</p>
		</div>

		<!-- KPI Cards -->
		<div class="grid grid-cols-4 gap-4 mb-8">
			<div class="bg-blue-50 p-4 rounded-lg">
				<p class="text-gray-600 text-sm mb-1">Total Tasks</p>
				<p class="text-2xl font-bold text-blue-600">24</p>
			</div>
			<div class="bg-green-50 p-4 rounded-lg">
				<p class="text-gray-600 text-sm mb-1">Completed</p>
				<p class="text-2xl font-bold text-green-600">16</p>
			</div>
			<div class="bg-red-50 p-4 rounded-lg">
				<p class="text-gray-600 text-sm mb-1">Overdue</p>
				<p class="text-2xl font-bold text-red-600">3</p>
			</div>
			<div class="bg-orange-50 p-4 rounded-lg">
				<p class="text-gray-600 text-sm mb-1">High Priority</p>
				<p class="text-2xl font-bold text-orange-600">8</p>
			</div>
		</div>

		<!-- Stacked Timeline by Project -->
		<div class="bg-white rounded-lg shadow p-6 mb-8">
			<h2 class="text-xl font-bold text-gray-900 mb-4">Task Timeline by Project</h2>
			<div id="timeline" aria-label="Task Timeline by Project" role="img"></div>
		</div>

		<div class="grid grid-cols-2 gap-8">
			<!-- Project Breakdown -->
			<div class="bg-white rounded-lg shadow p-6">
				<h2 class="text-xl font-bold text-gray-900 mb-4">Tasks by Project</h2>
				<div id="project-pie"></div>
				<div id="project-legend" class="flex gap-4 mt-4 overflow-x-auto whitespace-nowrap pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100" aria-label="Project Legend" style="max-width:100%;"></div>
			</div>

			<!-- Status Distribution -->
			<div class="bg-white rounded-lg shadow p-6">
				<h2 class="text-xl font-bold text-gray-900 mb-4">Status Distribution</h2>
				<div id="status-bar"></div>
			</div>
		</div>

		<div class="grid grid-cols-2 gap-8 mt-8">
			<!-- Role Distribution -->
			<div class="bg-white rounded-lg shadow p-6">
				<h2 class="text-xl font-bold text-gray-900 mb-4">Role Distribution</h2>
				<div id="role-pie" aria-label="Role Distribution Pie Chart" role="img"></div>
				<div id="role-legend" class="flex gap-4 mt-4 overflow-x-auto whitespace-nowrap pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100" aria-label="Role Legend" style="max-width:100%;"></div>
			</div>
		</div>
	</div>

	<script>
		// Sample data
		const tasks = [
			{ id: 1, title: "Design homepage", project: "Website", status: "Completed", dueDate: "2025-10-18", priority: 3 },
			{ id: 2, title: "API integration", project: "Mobile App", status: "Ongoing", dueDate: "2025-10-22", priority: 4 },
			{ id: 3, title: "Database schema", project: "Mobile App", status: "Overdue", dueDate: "2025-10-10", priority: 4 },
			{ id: 4, title: "Landing page copy", project: "Website", status: "Completed", dueDate: "2025-10-20", priority: 2 },
			{ id: 5, title: "Q4 roadmap", project: "Planning", status: "Under Review", dueDate: "2025-11-01", priority: 5 },
			{ id: 6, title: "User testing", project: "Website", status: "Ongoing", dueDate: "2025-11-05", priority: 3 },
			{ id: 7, title: "Performance audit", project: "Mobile App", status: "Completed", dueDate: "2025-11-08", priority: 2 },
			{ id: 8, title: "Documentation", project: "Docs", status: "Ongoing", dueDate: "2025-11-15", priority: 1 },
			{ id: 9, title: "Security review", project: "Mobile App", status: "Ongoing", dueDate: "2025-11-03", priority: 5 },
			{ id: 10, title: "Beta release", project: "Website", status: "Completed", dueDate: "2025-11-12", priority: 4 },
		];
		tasks.forEach(t => t.dueDateObj = new Date(t.dueDate));

		const statusColors = {
			"Completed": "#059669", // teal-600
			"Ongoing": "#2563eb",   // blue-600
			"Overdue": "#dc2626",   // red-600
			"Under Review": "#d97706", // amber-600
			"Unassigned": "#6b7280" // gray-500
		};

		// STACKED TIMELINE BY PROJECT
	const timelineMargin = { top: 20, right: 30, bottom: 80, left: 180 }; // more left and bottom margin
	const timelineWidth = 1400 - timelineMargin.left - timelineMargin.right;
	const timelineHeight = 550 - timelineMargin.top - timelineMargin.bottom; // taller
		const minDate = d3.min(tasks, d => d.dueDateObj);
		const maxDate = d3.max(tasks, d => d.dueDateObj);
		
		// Get unique projects and sort tasks by project, then by priority (ascending, 1 = highest)
		const projects = Array.from(new Set(tasks.map(d => d.project))).sort();
		const sortedTasks = tasks.sort((a, b) => {
			const projectOrder = projects.indexOf(a.project) - projects.indexOf(b.project);
			return projectOrder !== 0 ? projectOrder : a.priority - b.priority;
		});
		
		const timelineSvg = d3.select("#timeline")
			.append("svg")
			.attr("width", timelineWidth + timelineMargin.left + timelineMargin.right)
			.attr("height", timelineHeight + timelineMargin.top + timelineMargin.bottom)
			.attr("aria-label", "Timeline by Project")
			.append("g")
			.attr("transform", `translate(${timelineMargin.left},${timelineMargin.top})`);
		
		const timelineX = d3.scaleTime()
			.domain([minDate, maxDate])
			.range([0, timelineWidth]);
		
		const timelineY = d3.scaleBand()
			.domain(sortedTasks.map(d => d.title))
			.range([0, timelineHeight])
			.padding(0.25);
		
		// Project background bands
		// More distinct project highlight colors
		const projectColors = {
			"Website": "#bae6fd",      // blue-200
			"Mobile App": "#bbf7d0",  // green-200
			"Planning": "#fde68a",    // yellow-200
			"Docs": "#ddd6fe"         // purple-200
		};
		
		projects.forEach(project => {
			const projectTasks = sortedTasks.filter(d => d.project === project);
			const startY = timelineY(projectTasks[0].title);
			const endY = timelineY(projectTasks[projectTasks.length - 1].title) + timelineY.bandwidth();
			// More obvious highlight: higher opacity, border
			timelineSvg.append("rect")
				.attr("x", -timelineMargin.left + 5)
				.attr("y", startY)
				.attr("width", timelineWidth + timelineMargin.left - 10)
				.attr("height", endY - startY)
				.attr("fill", projectColors[project] || "#f3f4f6")
				.attr("opacity", 0.7)
				.attr("stroke", projectColors[project] || "#a3a3a3")
				.attr("stroke-width", 2)
				.attr("pointer-events", "none");
			// Project label on left
			timelineSvg.append("text")
				.attr("x", -timelineMargin.left + 8)
				.attr("y", startY + (endY - startY) / 2)
				.attr("dy", "0.35em")
				.attr("font-weight", "bold")
				.attr("font-size", "12px")
				.attr("fill", "#555")
				.attr("pointer-events", "none")
				.text(project);
		});
		
		// Dots - sized by priority (1=largest, 10=smallest)
		timelineSvg.selectAll("circle")
			.data(sortedTasks)
			.enter()
			.append("circle")
			.attr("cx", d => timelineX(d.dueDateObj))
			.attr("cy", d => timelineY(d.title) + timelineY.bandwidth() / 2)
			.attr("r", d => 12 - (d.priority - 1) * 0.8)
			.attr("fill", d => statusColors[d.status] || "#6366f1")
			.attr("stroke", d => d.priority <= 3 ? "#1f2937" : "#9ca3af")
			.attr("stroke-width", d => d.priority <= 3 ? 2 : 1)
			.attr("opacity", 0.85);
		
		// Axes
		// X Axis with rotated tick labels for readability
		timelineSvg.append("g")
			.attr("transform", `translate(0,${timelineHeight})`)
			.call(d3.axisBottom(timelineX).tickFormat(d3.timeFormat("%b %d")))
			.selectAll("text")
			.attr("transform", "rotate(-35)")
			.style("text-anchor", "end")
			.attr("dx", "-0.5em")
			.attr("dy", "0.5em");

		// Restore font size for axis
		timelineSvg.selectAll(".x.axis text").style("font-size", "12px");
		
		timelineSvg.append("g")
			.call(d3.axisLeft(timelineY))
			.style("font-size", "11px");
		
		// Axis labels
		timelineSvg.append("text")
			.attr("x", timelineWidth / 2)
			.attr("y", timelineHeight + 40)
			.attr("text-anchor", "middle")
			.style("font-size", "14px")
			.style("font-weight", "bold")
			.text("Due Date");
		
		// Move y-axis label further left to avoid overlap
		timelineSvg.append("text")
			.attr("transform", "rotate(-90)")
			.attr("y", -timelineMargin.left + 5) // further left
			.attr("x", -timelineHeight / 2)
			.attr("text-anchor", "middle")
			.style("font-size", "14px")
			.style("font-weight", "bold")
			.text("Task Name");

		// PROJECT PIE CHART
		const projectMargin = { top: 20, right: 20, bottom: 20, left: 20 };
		const projectWidth = 400 - projectMargin.left - projectMargin.right;
		const projectHeight = 300 - projectMargin.top - projectMargin.bottom;
		const projectRadius = Math.min(projectWidth, projectHeight) / 2;

		const projectCounts = d3.rollup(tasks, v => v.length, d => d.project);
		const projectData = Array.from(projectCounts, ([name, count]) => ({ name, count }));

		const projectSvg = d3.select("#project-pie")
			.append("svg")
			.attr("width", projectWidth + projectMargin.left + projectMargin.right)
			.attr("height", projectHeight + projectMargin.top + projectMargin.bottom)
			.append("g")
			.attr("transform", `translate(${projectWidth / 2 + projectMargin.left},${projectHeight / 2 + projectMargin.top})`);

		const color = d3.scaleOrdinal().domain(projectData.map(d => d.name)).range(["#3b82f6", "#10b981", "#f59e0b", "#ef4444"]);
		const pie = d3.pie().value(d => d.count);
		const arc = d3.arc().innerRadius(projectRadius * 0.4).outerRadius(projectRadius);

		projectSvg.selectAll("path")
			.data(pie(projectData))
			.enter()
			.append("path")
			.attr("d", arc)
			.attr("fill", d => color(d.data.name))
			.attr("opacity", 0.8)
			.on("mouseover", function() { d3.select(this).attr("opacity", 1); })
			.on("mouseout", function() { d3.select(this).attr("opacity", 0.8); });

		projectSvg.selectAll("text")
			.data(pie(projectData))
			.enter()
			.append("text")
			.attr("transform", d => `translate(${arc.centroid(d)})`)
			.attr("text-anchor", "middle")
			.attr("dy", "0.35em")
			.text(d => d.data.count)
			.style("fill", "white")
			.style("font-weight", "bold")
			.style("font-size", "14px");

		// PROJECT PIE LEGEND
		const projectLegend = d3.select("#project-legend");
		projectLegend.selectAll("div")
			.data(projectData)
			.enter()
			.append("div")
			.attr("class", "inline-flex items-center space-x-1 mr-4 mb-1")
			.html(d => `
				<span style="display:inline-block;width:14px;height:14px;background:${color(d.name)};border-radius:3px;border:1px solid #ccc;"></span>
				<span class="text-gray-700 text-xs font-medium">${d.name}</span>
				<span class="text-gray-400 text-xs">(${d.count})</span>
			`);

		// STATUS BAR CHART
		const statusCounts = d3.rollup(tasks, v => v.length, d => d.status);
		const statusData = Array.from(statusCounts, ([status, count]) => ({ status, count }))
			.sort((a, b) => b.count - a.count);

		const statusMargin = { top: 20, right: 20, bottom: 30, left: 80 };
		const statusWidth = 400 - statusMargin.left - statusMargin.right;
		const statusHeight = 300 - statusMargin.top - statusMargin.bottom;

		const statusSvg = d3.select("#status-bar")
			.append("svg")
			.attr("width", statusWidth + statusMargin.left + statusMargin.right)
			.attr("height", statusHeight + statusMargin.top + statusMargin.bottom)
			.append("g")
			.attr("transform", `translate(${statusMargin.left},${statusMargin.top})`);

		const statusY = d3.scaleBand().domain(statusData.map(d => d.status)).range([0, statusHeight]).padding(0.4);
		const statusX = d3.scaleLinear().domain([0, d3.max(statusData, d => d.count)]).range([0, statusWidth]);

		statusSvg.selectAll(".bar")
			.data(statusData)
			.enter()
			.append("rect")
			.attr("y", d => statusY(d.status))
			.attr("height", statusY.bandwidth())
			.attr("width", d => statusX(d.count))
			.attr("fill", d => statusColors[d.status])
			.attr("opacity", 0.8)
			.on("mouseover", function() { d3.select(this).attr("opacity", 1); })
			.on("mouseout", function() { d3.select(this).attr("opacity", 0.8); });

		statusSvg.append("g")
			.attr("transform", `translate(0,${statusHeight})`)
			.call(d3.axisBottom(statusX))
			.style("font-size", "12px");

		statusSvg.append("g")
			.call(d3.axisLeft(statusY))
			.style("font-size", "12px");

		// ROLE PIE CHART
		const roleMargin = { top: 20, right: 20, bottom: 20, left: 20 };
		const roleWidth = 400 - roleMargin.left - roleMargin.right;
		const roleHeight = 300 - roleMargin.top - roleMargin.bottom;
		const roleRadius = Math.min(roleWidth, roleHeight) / 2;

		const roleData = [
			{ name: "Owner", count: 14 },
			{ name: "Collaborator", count: 10 }
		];
		const totalRoles = roleData.reduce((sum, d) => sum + d.count, 0);

		const roleSvg = d3.select("#role-pie")
			.append("svg")
			.attr("width", roleWidth + roleMargin.left + roleMargin.right)
			.attr("height", roleHeight + roleMargin.top + roleMargin.bottom)
			.append("g")
			.attr("transform", `translate(${roleWidth / 2 + roleMargin.left},${roleHeight / 2 + roleMargin.top})`);

		const roleColor = d3.scaleOrdinal().domain(["Owner", "Collaborator"]).range(["#3b82f6", "#8b5cf6"]);
		const rolePie = d3.pie().value(d => d.count);
		const roleArc = d3.arc().innerRadius(0).outerRadius(roleRadius);

		roleSvg.selectAll("path")
			.data(rolePie(roleData))
			.enter()
			.append("path")
			.attr("d", roleArc)
			.attr("fill", d => roleColor(d.data.name))
			.attr("opacity", 0.85)
			.on("mouseover", function() { d3.select(this).attr("opacity", 1); })
			.on("mouseout", function() { d3.select(this).attr("opacity", 0.85); });

		roleSvg.selectAll("text")
			.data(rolePie(roleData))
			.enter()
			.append("text")
			.attr("transform", d => `translate(${roleArc.centroid(d)})`)
			.attr("text-anchor", "middle")
			.attr("dy", "0.35em")
			.style("fill", "#fff")
			.style("font-weight", "bold")
			.style("font-size", "14px")
			.text(d => `${d.data.count} (${Math.round((d.data.count/totalRoles)*100)}%)`);

		// ROLE PIE LEGEND
		const roleLegend = d3.select("#role-legend");
		roleLegend.selectAll("div")
			.data(roleData)
			.enter()
			.append("div")
			.attr("class", "inline-flex items-center space-x-1 mr-4 mb-1")
			.html(d => `
				<span style="display:inline-block;width:14px;height:14px;background:${roleColor(d.name)};border-radius:3px;border:1px solid #ccc;"></span>
				<span class="text-gray-700 text-xs font-medium">${d.name}</span>
				<span class="text-gray-400 text-xs">(${d.count})</span>
			`);
	</script>
</body>
</html>